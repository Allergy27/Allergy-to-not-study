#!/usr/bin/env python
# -*- coding: utf-8 -*-
from Crypto.Util.number import *
from gmpy2 import *

flag = b'flag{******}'.strip(b'flag{').strip(b'}')
_length = len(flag)
f1, f2, f3 = [flag[_*_length//3:(_+1)*_length//3] for _ in range(3)]

e = 0x10001

# part1
m1 = bytes_to_long(f1)
p1 = getPrime(1024)
q1 = getPrime(1024)
n1 = p1 * q1
phi1 = n1 - p1 - q1 + 1
c1 = pow(m1, e, n1)
e1 = invert(getPrime(730), phi1)
e2 = invert(getPrime(730), phi1)
print(f"c1={c1}")
print(f"n1={n1}")
print(f"e1, e2={e1}, {e2}")
# c1=18256586437688071179499177390976877033843124074731118595784275706275462549393575070193713157285247155052783040660186349191946243206621283417854114947512338510120090494075462629459661733719232454448765943733550405428870484328139300079099605288398777526459160412929323065084297815106233447065396152086777361372972058145457645409788067204097788931227023450019519408351421367564315618548463098307984698849151129213729707495350390245146946120917928822783651413957541976992382340037410396051196233685887265029041398105471757470103910841819186967349443174641098166881199762042452259613391893862411694579851230262676110579543
# n1=23818305284450407798474543841442778164118430521610043726789505700531857211139233983927667740426681473611421781216471548321033175378524550659451949200683096575646597770420333524204176282763665882864564388471765969302954420394630419303362777912490426962573169221783887636684177478144311692343348905299751465406910364431823004781961449409682714094129123403882257872835302752664170847941259148324938528680748942030111986004367624657807913886922193265189704092735093802344832636336165737460259604641005316302692291726246828545907406645433265956061936110408800751546469158181520009116013316133121377819590970122050812854789
# e1, e2=9835783673095553446058291384176228043002331943350999034534623274992838739022521971236805050273046260025059987203730927700121664052723407432747645871296445872656798765584552764267628989278697521984943241908192986396530077301150942289434104385028360155639928443785704472753619847188084726935475600846835326073460115218216212785556408708462269105328394030996217916556873627266842330668453858483713498138654428487949944189108261563568558572124107380903712891578297171120862197369764331518753921684965420121318071916309204747667657476806551055584210466752436702176078704990826846481952895354353484344820523539218467328609, 17375316355314118406320219911734421029944943076411309671685926390155316380478008061756850363872585667159388923531318955662085005614917843442976105969167039475936924220396528915648168982023113542542201704319766653086540015877222620054173299245668195344488548155446059033287516207223970884670005185996184076538885012087996848877993859469631166842992572290730174768464087877396078823473042762659765399198326507762349243538341205082556290883091174177379098626493382561067493560893603313231705260729621890489619111083150474886626958850812093915647702385689897792432029133765456750687073104627271449802966450876185872407293

# part2
m2 = bytes_to_long(f2)
p2 = getPrime(1024)
q2 = getPrime(1024)
n2 = p2 * q2
phi2 = n2 - p2 - q2 + 1
c2 = pow(m2, e, n2)
e1 = invert(getPrime(818), phi2)
e2 = invert(getPrime(818), phi2)
e3 = invert(getPrime(818), phi2)
print(f"c2={c2}")
print(f"n2={n2}")
print(f"e1, e2, e3={e1}, {e2}, {e3}")
# c2=7397948118661629179431783988040895458789705611348057007436744924286606845506855024757017008422428346125155256072479048132488726422383082177040419485079781614025786874885731238970838063149169856879853922252545180431913045657720759213963468939845495598431323068663802344702417525106006065710075781595178977530059183311799912042111388947291033904817085717108188090145344450358175045073581429955014610154068361313141588492645221701328206295786968873864994686829696270486416698396375950394734029806666802284536304945414547079574607730266434796754246916153856829680842431766222116151718709429059719233175642356185763549753
# n2=26292951661012369717063123837935212187841837990937409862727543775909692635777293262933237685397758431603024805843199727419651370601525732880424359196307914374216191509283135963748357779924092043495625603225506028009487151069654694577076720362009705789203840905789543087928861357322986605749368970969266743654319969904026952962322268379225380213707065355992305857296471145718799765135536018612126827479085590220735158169406914216754985647564372724826515679007973592809045174602317195367577976810859435543162819060475161099374850589836987534136681356679103268055423382163949544464079781246652055582200248909247668623499
# e1, e2, e3=22694706397978285590465671518110674052151119930148512503108564673150680783241121101786666274181726238526861523022918702466855620573530844233715770144139721716134989018155976236479107110312927457994481310468761498848616794416315070862907683495124078074007557127579845015890427714070653740357339462879130069957999436928214586731086684031472873906400037412726424268791786559621038152550518294176306295751353922800351665127092290118894154132754742176211704948795270899801653386827500439967394284110599220882384625850203226545462281069378693815073612231125489131101884329197443266832244811697310523718069196439987874560039, 19757693768817797436014051982525313310314202171979163256271236145574495661645212918338708496186679729064506769796601795165991111866727894236670818742409747080245075024690888305402144135268609274687612318745424595896798226707126823118123835608467111180582358621936132151152853801341025288787721743741457146001947620952829255159920921457848946646082875838154605722012404441365333587571345884871498937612639283634536627265761252205175359486536891516203565325566130199281073669565197277276475101795697133209290035232673428798516588817127360784579513454813838885851841273303461997814139565597376680331988797853669080243125, 11389981852832984357137509986679549123500155102837206910639496363918096101772914255008780837117260552841880430413524483339337830003709650579991621915081444343612271861556752359650402097545780278089588646712811404815644175255214558530767310601635041857471275711027346133308388815005294337668424266111374150795611611729636047618889325059128343980592920017154112277259693587094401884519031089809597582576905458587648918184434226675368577535209126874445550629139076565822733137255015869694623787301488148409890116680369767358783472079078515354151433058595644462125347850789885910919439106962937134732744338568617745128967

# part3
m3 = bytes_to_long(f3)
nl = []
cl = []
el = []
d = getPrime(890)
for _ in range(7):
    p3 = getPrime(1024)
    q3 = getPrime(1024)
    n3 = p3 * q3
    phi3 = n3 - p3 - q3 + 1
    e3 = invert(d, phi3)
    c3 = pow(m3, e3, n3)
    nl.append(n3)
    el.append(int(e3))
    cl.append(int(c3))
print(f"nl={nl}")
print(f"el={el}")
print(f"cl={cl}")
# nl=[28128431046015920275867401286356210186873411685478225083238434242778529896356941580973185976712335001794663072564844732266238921796620069046120085128987062349623903063937626930036832752240804753615027907296696919621178396785514262849051292237767466623865189316968144483530841069450843830586104632368630098173422466097902528211336564071538019195182730662473448037566051252093060016358138753900185472818830783886471271957145982784959717506947893840152372869449542083974320464199709054150465116404220039449614767664775277210885637192112937179733541728803915947236386551780231184983955344562543084441967041096292458376711, 15941506764496112508086052445327563728557019020078403891991153376527680537441120403641357307838049073871504911062932911390252596138562138738121838821774304227295619282998367749457407690200844932291746003035986895786486272990112974619702508463562341341486618806649097006148590651055205870202131969821864469531413390466032451046414385794250382725806806469557696016961113664094579447098216980438732354400216822110095599978486596626559554670623724534471803753371502013382476835636833623961163252007815503857230563136875926773677694952774930390199545373174286276659079179782760775099348228882359572989794469305007548483463, 21477075191355162812530780733492391510998687571929884007754343338217435717723078625867501718883021697292552859713102793004898230501513651427792290139803056096105899520901185500534675197066732063111553356999784006468800654532784390510131074272274140065033279545358937887893282115742876247538911953084604041666594857908821695710188977632527449792927226528437488330994788573676058689785336341090592867992073284266470554036932587257232710754132223616433438742408141296595032485887389048533539393386947037848156856122741177785829677708820778474278035795448245432257299596803757486791164446634079910181210714713733372671911, 27980889842923013696925370227314883351112276566930742332614155408917061547016052804045130934740805370672123172039414349307825814361034576591769123747969419641723024382268105732067377670209049817740440071900428023370197175270058068369286335684544707615641510484861691897469481272042885633818294183456922932916414380110239847800912427429844344314157418225375848872607078506966318368615017622795077067727056494247405810786114331212410753456354286007804891304086536769744925235306620990637998664507493246274192941211107940741079651283398114143594202874858518873967351418681842387890477536989963517627233818078769872024099, 11874512534960363610348099809383055730190731633139047777794630866338724076849679318959138590079219714369272652232029634575769480906993953424481082345379951992371000294442939639023035588875329933006584525836825284114165074336564042070288737334300716196397732835850677754402788646656939033576803885217333700571342614700068898184831574911453135933166402149352532700966385018867315597386959703124420136720323657936158849606781246207578185098868411093558545759911002127927731801893936927711562592507156698173904805443256216186768581869260553775270507875595246062147686531439308227631060321898833423587908211847300295270541, 15224675376327505356831569909735574629657890400776701610305654819907338639680897170276155541718568366576578685733979395304498350342741176913341687981341047489341678830998584508207712326879527388637351546222470352815645028747751518769571267491178143330053291625300609753897430877369550522803344790304041776136475457741607217964022820540138279326779694758410710361845223020013300516123688449750203597390967832308257425422416891725632686779454075522671608333393334956510769340136789700534379832325374383981987145894876020631335806712116055479763976321369147061003597318319341832406808540251027139169804520307379254193911, 20816310004366530476460562555539654674418948353501847467772259029157821562413984155173799071470563734631451286934848199404215819237074319460122959657265122785540839955448942096240400390688021147068313910310136849708330452368106995869836582428664254704838254068051209657594167253854071985672239873828143536953578223704832843191125646078632060809066517611352539785999159417953446228290043126014999475618992062521426364158104320015542683820261806457508236522292308223400233157038832803058231221854838414229506865129259290367651741435376247393950181576477044543309625151522964580486029253188703166701416480246712408716561]
# el=[25987918902602819707355417677858606609564539201084261601955138897744478662609433466870376126863279143678546516578590636771686005269591202142781390429352674195847557789863785630030461839151977887687779625070348014569441498317342362224053350986332682205040139621968137375627286210989585620241023030542062491956644866161789553693303924904583362137701613987159680094610425420062630506811714851881297200144117227367581461665645347500385404099699049540313824556593436186114124998427439961906526399240877190941336731287205087274899973043658083856290959261316034140784652702636341177275986111369924533651087497121981411086641, 11536583869625988508580475631817303586006854830350523024412987588935845823023883852920254639794911650478520494878968696967691629551470187064945696636487184768815655116118691937690267890433919887243265415382935382621919010979428900160889923289872309079870131039861976961857247394973842892229104187727894146945719145241398225468068442444762284423975487962972810264253002725811920750237549943221691945146164637875029949453222340170316830566866460717947954445472125958208144393628697341126850011436603502039964795983344628985478814674883393836396792128585891973468122526753412371623102847053159881215069649746044442796473, 6258382822367086007225466509089340383168990334994920939821202703275482323559910500830774564971362610273956504472668941608974102860239889022987078255597553090784741120859013739331103145046515896385914609224011705413836786407003752801490386031297804601461281831439173237022171576886020760321801450896893301134251120263729177739080455729439579694010774362517414387229006315197300961428045644005355772284786988716183767126531903718158185009941082674259385548907556563830189396453583069164801994004519642883605218373911517780829617521468589603233453056364198116633465761417250496741120018226850674916996281060732818177713, 1123271919838701598528867652197027167108863099080539439683368111052848971050356301445541307599855193093285176394529636686839284398499313003303875483280650883518085849157395654639509563320433076242436157589788737085600921802127800392348484141324778072261733029943093540242953791392717406718793264320412059241664384125317692959822942865554124478061534413794506942706216684567887262335117795180246865844961628486792518440932323761939487437693274693348212527118853647714892440036123200291042783354708238669252146887837536937057836858644441676296976517393455047925205783218624166632883408885640587672623273544610707177337, 7118479545023295405954707588228963059779204215931744790012430867010886923630125777758479840356731132074231013958169490088750850158980478630228301124508139341605160418641100871694139295433992477145251484772488467770544460756937684075318618269708022708943657701006351914547226687757500586582514797116655719921812856058421477677383120990505423968690434260247690106392926974185831928187962019940081949090884552654532497775074390863008944239582948962034595432778383883768645022793045062556784866939097597147717746406461966452475555161864364206706548330688718531837292035417777920365769331512894998241380176286709233982233, 13168734473943163973336302938913009485584587645261879444423127999237276204801622018382168698586708899788485181446147855603048194008231372985440958811912413689189104368977285091427209494304044543816972986547281293076219706872396072099247741854856260139091655620083617631378983869562381890672791152052021667510098917909814894363745294783081153365256719554496003561980502654918138082438643448784070693187085148005714372832426443057685314490413304498915962462215928873536308587910941142514653628475699545920118841784415324555829850701207604322337888161717520903549660525384083717699987039930396783965836669692586308209913, 10479961891654965767491906245342872228844927757721355813604079195987086528159311957937936581019829393661353507095655683659990579245336183813954518053160333581264563954422462161788984192939046869882345792536442687521609190445778773394934490714985370747218345404477285010857033947034316927641328406615796993324770709801331802795809891508456365006132056751453526859303222749394183497569204878882577050674415770946288236332857975211044861894002469704354986616256888238270238451220336175388799527737680012791247165508229068505716865738130520887039730007913317547732180348300974011549814044852246713637353862001647619732089]
# cl=[26990762025926015361234554701824922852211737686951071728314895652079280694833459349457539819581710501091844863357783651498529916438540415271388894954614080355176013671098789906585874283088493827368394079519107218799350991599836515587725214687726531757345836586117125798489983888025727317000884547361106409944115351385448001534261902879780968571020927393069986791941133842440263336191976813568599682529840777140658530476866114439626339887120876189411994772147548593212898680660088067972989020417831956214852302957598511086650745777023549372509081238507748441858758742568940674542745316818533509687968838045095660065593, 10187006506448325093437749195595319616438787017815805096383994457841471147784782392778196703787543049224207989504604607667426619024848476149096629397741679263594816432358822858808999754941537921535656336459441935958760974441756103850392753798600679048066631067314051766211080267819766834875185440033035269407200524143849241200928556861137591406815596425699743894432058105826025235362144103999108017137071206732151707892607679286387859478482232650312169149560302273351509494002355028010263541967524011761420957240952539252470835137718061903237470399239252503603073646645543293084875096408433482631819950804704590213310, 6437886423532401505048832011897699791749142458059174236212150075678324130837231703120523386021792518586037900591770595038410601563237211433996040367176424928889232019032175841163032057391888036430661550510359218405547004630058511178419502307233167388101271878527720260785247331379693949065587035953102280225288107902138759092336134228409786908781844325563795389688702716085105618641694958233606444462872589472346619785562576605827447340481324049463101535618702633227703494114766406229048498744719858802190984312882620049856622512923072706292686533489371133361492211391641548997776130665513185747376942409108517568769, 9109419848847714707324785769294220551699826371741022421740481799153944747138951942702248188586750915080390038722862917295761759545509031535092118635969900089921761598830510617605389891709645930785237246250062089364328837705022792423177110287540439828479475892711454759357949680768401483320330224922882420136801723810705059368507707842781543178268194075102769783446978702349789472329697747686575772335958274138755100220031340839119154414149956654777253313278877225822628523455998403052905172866471553882160286716933267892305764288184304897340982312895459694369200084691148460616870734019126068390508532732349357484737, 8351339877593066668024292626867587579118261160780795372250031046729582107846522796043372481089114437606076932490100911054500322254834811554892028468047141453946329715956923796952627591877865718723630799195025165699575257880477805590157419891041381046741986394027088622282885742946193482028755290003668399319477702639537706545291913403262719438293323658066390552307136304152762652901787194357037615440560239782969180234716552992929240295404721674843511696949057158900079758396630140897388219780133821373557024790079317123646367949487240329104202305605994129222864435721143717628545080984866553703684175979084033306658, 1964324528491408960940929058788452854160783870059496839692187136208084448309278604948579872491954065334369936581836562428242125848874621458839384825495758715562491677448056002866026151323350286710046602991373918873739469550035701019416028242241104986701591734668541888471299964830159333923615834397691438469107575406450368417418983160234443451155327263329737035233317986645236959480514469996246393545768714323729817706436697657717844493164954490820859371208274022136828013894747179248313389766670142628017962271590652010675201939163178721703732160625989524967212781547107236036268542401156332669855197379957220332115, 15290594258136384536690269021543178605821222755985953605899452132821317243018315945404106072716041806288147362903420336688433158484645044327418082073837905264849007099334862944581816752859147422920273814840319353668344366464979435623370261859929759383441080420575537882699234094906701470123926193900516484880255578323878876408561814025885958039357576248573127200715225321776940563297949344489237568596687199693667693747547169826521811101208665509704948300938983245076152307820653158912381008609443385839728517818010309909965072025108373110210561129455904261079964181719756671900849144940938572853269177896724549344582]